<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Vape Bot — Профиль</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg-0:#0A0F1E; --bg-1:#0F172A; --text:#E5F0FF; --muted:#91A4C7;
      --accent:#22D3EE; --error:#F87171; --radius:16px; --tab-h:64px;
      --shadow-neon:0 0 0 1px rgba(34,211,238,.35),0 0 24px rgba(34,211,238,.2);
      --shadow-neon-strong:0 0 0 1px rgba(34,211,238,.65),0 0 32px rgba(34,211,238,.45);
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg-0); color:var(--text);
      font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      padding-bottom: calc(var(--tab-h) + env(safe-area-inset-bottom, 0px) + 8px);
    }
    .page{max-width:720px;margin:0 auto;padding:16px}
    .card{
      width:100%;
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.06);
      border-radius:calc(var(--radius) + 6px);
      padding:20px 20px 16px;
      box-shadow:0 8px 30px rgba(2,12,27,.55);
      backdrop-filter:blur(6px);
    }
    .grid{display:grid;gap:12px}
    /* Поля и плавающие лейблы (только .flabel) */
    .field{position:relative}
    .control{width:100%;background:var(--bg-1);border-radius:var(--radius);border:1px solid rgba(255,255,255,.07);padding:18px 14px 14px;outline:none;transition:box-shadow .18s,border-color .18s,background .18s}
    .control::placeholder{color:transparent}
    .field .flabel{position:absolute;left:14px;top:16px;font-size:14px;color:var(--muted);pointer-events:none;background:none;z-index:1;transition:all .16s ease}
    .control:focus,.control:not(:placeholder-shown){background:rgba(14,23,42,.85)}
    .control:focus{box-shadow:var(--shadow-neon);border-color:rgba(34,211,238,.45)}
    .control:focus ~ .flabel,.control:not(:placeholder-shown) ~ .flabel{top:4px;font-size:12px;color:var(--accent)}
    .error-msg{margin-top:6px;font-size:12px;color:var(--error);display:none}
    .field.error .error-msg{display:block}
    .field.error .control{border-color:rgba(248,113,113,.6)!important;box-shadow:0 0 0 1px rgba(248,113,113,.55),0 0 22px rgba(248,113,113,.25)!important}
    /* Радио-пилюли */
    .pills{display:flex;flex-wrap:wrap;gap:8px;align-items:center;min-height:44px}
    .pills .radio{position:absolute;width:1px;height:1px;margin:-1px;padding:0;border:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap}
    .pill{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:999px;cursor:pointer;user-select:none;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.09);transition:box-shadow .18s,border-color .18s,background .18s,transform .06s}
    .pill:hover{border-color:rgba(255,255,255,.18)}
    .pills .radio:checked + .pill{background:linear-gradient(180deg,rgba(34,211,238,.18),rgba(167,139,250,.16));border-color:rgba(34,211,238,.65);box-shadow:var(--shadow-neon)}
    .pills .radio:focus + .pill{outline:2px solid var(--accent);outline-offset:2px}
    /* Select */
    .field.select{margin-top:4px}
    .field.select .top-label{display:block;margin:0 0 6px 4px;font-size:12px;color:var(--muted);line-height:1}
    .select-box{position:relative}
    .select-box select{position:relative;z-index:1;width:100%;appearance:none;-webkit-appearance:none;-moz-appearance:none;background:var(--bg-1);color:var(--text);border-radius:var(--radius);border:1px solid rgba(255,255,255,.07);padding:16px 42px 14px 14px;outline:none;transition:box-shadow .18s,border-color .18s,background .18s}
    .select-box select:focus{box-shadow:var(--shadow-neon);border-color:rgba(34,211,238,.45);background:rgba(14,23,42,.85)}
    .select-box .chev{position:absolute;right:14px;top:50%;transform:translateY(-50%);pointer-events:none;opacity:.75}
    .field.select .select-box>label{display:none!important}
    /* Кнопки */
    .actions{display:flex;gap:10px;justify-content:flex-end;padding-top:8px}
    .btn{padding:12px 16px;border-radius:14px;border:1px solid transparent;cursor:pointer;font-weight:600;background:linear-gradient(180deg,rgba(34,211,238,.18),rgba(167,139,250,.16));color:var(--text);box-shadow:var(--shadow-neon);transition:box-shadow .18s,transform .06s,border-color .18s,background .18s}
    .btn:hover{box-shadow:var(--shadow-neon-strong)} .btn:active{transform:translateY(1px)}
    .ghost{background:transparent;border-color:rgba(255,255,255,.12)}
    .meta{opacity:.7;font-size:12px;text-align:center;margin:12px 0 6px}
    /* Tabbar */
    .tabbar{position:fixed;left:0;right:0;bottom:0;background:rgba(8,12,22,.8);border-top:1px solid rgba(255,255,255,.06);backdrop-filter:blur(10px);display:flex;justify-content:space-around;align-items:center;height:var(--tab-h);padding:8px 8px calc(8px + env(safe-area-inset-bottom, 0px));z-index:50}
    .tab{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;text-decoration:none;color:var(--muted);font-size:12px;font-weight:600;padding:8px 0;border-radius:10px;transition:color .15s, background .15s}
    .tab svg{opacity:.7;transition:opacity .15s, transform .1s}
    .tab:active svg{transform:translateY(1px)}
    .tab.active{color:var(--accent)} .tab.active svg{opacity:1}
  </style>
</head>
<body>
  <main class="page">
    <form id="profileForm" class="card" novalidate>
      <div class="grid">
        <div class="field" id="f-firstname">
          <input class="control" type="text" id="firstName" name="firstName" placeholder=" " autocomplete="given-name" required />
          <label class="flabel" for="firstName">Имя</label>
          <div class="error-msg">Укажите имя.</div>
        </div>

        <div class="field">
          <input class="control" type="text" id="lastName" name="lastName" placeholder=" " autocomplete="family-name" />
          <label class="flabel" for="lastName">Фамилия</label>
        </div>

        <div class="field">
          <input class="control" type="text" id="middleName" name="middleName" placeholder=" " />
          <label class="flabel" for="middleName">Отчество</label>
        </div>

        <div class="field" id="f-birth">
          <input class="control" type="text" id="birthDate" name="birthDate" inputmode="numeric" placeholder=" " maxlength="10" required />
          <label class="flabel" for="birthDate">Дата рождения</label>
          <div class="error-msg">Формат: ДД.ММ.ГГГГ</div>
        </div>

        <div class="field" id="f-email">
          <input class="control" type="email" id="email" name="email" placeholder=" " autocomplete="email" required />
          <label class="flabel" for="email">Email</label>
          <div class="error-msg">Введите корректный email.</div>
        </div>

        <div class="field" id="f-gender">
          <div class="top-label" id="genderLabel">Пол</div>
          <div class="pills" role="radiogroup" aria-labelledby="genderLabel">
            <input class="radio" type="radio" id="g_m" name="gender" value="male">
            <label class="pill" for="g_m">Мужской</label>
            <input class="radio" type="radio" id="g_f" name="gender" value="female">
            <label class="pill" for="g_f">Женский</label>
            <input class="radio" type="radio" id="g_o" name="gender" value="other">
            <label class="pill" for="g_o">Другое</label>
          </div>
          <div class="error-msg">Выберите вариант.</div>
        </div>

        <div class="field select">
          <div class="top-label" id="sourceTop">Откуда вы узнали о нас?</div>
          <div class="select-box">
            <select id="source" name="source" aria-labelledby="sourceTop">
              <option value="" selected disabled>Выберите вариант</option>
              <option>Друзья/знакомые</option>
              <option>Телеграм/чаты</option>
              <option>Реклама</option>
              <option>Проходил мимо</option>
              <option>Другое</option>
            </select>
            <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn ghost" id="clearBtn">Очистить</button>
        <button type="submit" class="btn" id="saveBtn">Сохранить</button>
      </div>

      <div class="meta">@Vapes_Catalog_Bot</div>
    </form>
  </main>

  <nav class="tabbar" role="tablist" aria-label="Навигация">
    <a class="tab" href="map.html">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M9 6l-5 2v10l5-2 6 2 5-2V6l-5 2-6-2z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
      <span>Карта</span>
    </a>
    <a class="tab" href="history.html">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M6 4h12v16H6zM9 8h6M9 12h6M9 16h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      <span>История</span>
    </a>
    <a class="tab" href="chat.html">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M20 12a7 7 0 0 1-7 7H6l-2 3V12a7 7 0 1 1 16 0z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
      <span>Чат</span>
    </a>
    <a class="tab" href="info.html">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/><path d="M12 8h.01M11 11h2v5h-2z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      <span>Инфо</span>
    </a>
    <a class="tab active" href="profile.html" aria-selected="true">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm7 8a7 7 0 0 0-14 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      <span>Профиль</span>
    </a>
  </nav>

  <script>
    const $  = (s,p=document)=>p.querySelector(s);
    const $$ = (s,p=document)=>[...p.querySelectorAll(s)];
    const tg = window.Telegram?.WebApp;

    function applyTelegramTheme(){
      if(!tg || !tg.themeParams) return;
      const t = tg.themeParams, r = document.documentElement.style;
      if(t.bg_color)     r.setProperty('--bg-0', t.bg_color);
      if(t.text_color)   r.setProperty('--text', t.text_color);
      if(t.hint_color)   r.setProperty('--muted', t.hint_color);
      if(t.button_color) r.setProperty('--accent', t.button_color);
    }
    if(tg){ tg.ready(); tg.expand(); tg.onEvent('themeChanged', applyTelegramTheme); applyTelegramTheme(); }

    // Маска даты
    const bd = $('#birthDate');
    bd.addEventListener('input', ()=>{
      let v = bd.value.replace(/\D/g,'').slice(0,8);
      if(v.length>=5) v = v.replace(/^(\d{2})(\d{2})(\d{1,4}).*/, '$1.$2.$3');
      else if(v.length>=3) v = v.replace(/^(\d{2})(\d{1,2}).*/, '$1.$2');
      bd.value = v;
      $('#f-birth').classList.remove('error');
    });

    // Валидация
    function validate(form){
      let ok = true;
      if(!form.firstName.value.trim()){ $('#f-firstname').classList.add('error'); ok=false } else $('#f-firstname').classList.remove('error');
      const reD=/^([0-2]\d|3[01])\.(0\d|1[0-2])\.(19|20)\d{2}$/;
      if(!reD.test(form.birthDate.value.trim())){ $('#f-birth').classList.add('error'); ok=false } else $('#f-birth').classList.remove('error');
      const reE=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
      if(!reE.test(form.email.value.trim())){ $('#f-email').classList.add('error'); ok=false } else $('#f-email').classList.remove('error');
      if(!document.querySelector('input[name="gender"]:checked')){ $('#f-gender').classList.add('error'); ok=false } else $('#f-gender').classList.remove('error');
      return ok;
    }

    $('#profileForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const form = e.currentTarget;
      if(!validate(form)) return;

      const data = {
        firstName: form.firstName.value.trim(),
        lastName: form.lastName.value.trim(),
        middleName: form.middleName.value.trim(),
        birthDate: form.birthDate.value.trim(),
        email: form.email.value.trim(),
        gender: (document.querySelector('input[name="gender"]:checked')||{}).value || '',
        source: form.source.value
      };
      if(tg) tg.sendData(JSON.stringify({type:'profile', payload:data}));
    });

    $('#clearBtn').addEventListener('click', ()=>{
      const f = $('#profileForm'); f.reset();
      $$('#profileForm .field').forEach(el=>el.classList.remove('error'));
    });
  </script>
</body>
</html>
